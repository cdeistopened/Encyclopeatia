# Ray Peat EncycloPEATia - Context Handoff
## Date: 2026-01-03
## Model: Claude Sonnet 4

## Current Situation & Frustration
User is rightfully frustrated because I've been overcomplicating the restoration process. The goal was simple: restore the working EncycloPEATia design from GitHub repo commit 255893f and apply Railway deployment fixes.

## What Went Wrong
1. **Incomplete restoration**: I only partially restored files from the GitHub repo
2. **Missing critical directories**: components/, data/, lib/ were missing from our project
3. **Design inconsistencies**: Found that different pages used different design systems
4. **Over-engineering**: Instead of clean restoration, I kept trying to patch/fix individual issues

## Source of Truth: GitHub Repo Commit 255893f
- **Repo**: https://github.com/cdeistopened/Encyclopeatia
- **Commit**: 255893f (the one with proper EncycloPEATia design)
- **Key finding**: Ask Peat page was styled correctly in this commit
- **Unknown**: Whether episode pages were also properly styled in this commit

## Deployment Issues We Already Solved
1. **Node.js Version**: Need `"engines": {"node": ">=20.9.0"}` in package.json for Railway
2. **FastAPI Backend**: Created complete backend with main.py, config.py, requirements.txt
3. **Next.js 16 Compatibility**: API routes need `params: Promise<{}>` and await params
4. **CORS Configuration**: Backend needs proper CORS middleware

## Current Project State
- **Located**: `/Users/charliedeist/Library/Mobile Documents/com~apple~CloudDocs/Root Docs/Ray Peat/app/`
- **Git status**: Clean, up to date with origin/main
- **Missing files**: Some components/, data/, lib/ files from original GitHub repo
- **Design inconsistency**: Pages use different design systems instead of unified EncycloPEATia

## Tomorrow's Plan
1. **Start fresh**: Use commit 255893f as the new source of truth
2. **Complete restoration**: Download/clone the ENTIRE original repo structure
3. **Verify styling**: Check if episode pages have proper EncycloPEATia design + transcript toggle
4. **Apply deployment fixes**: Layer on the Railway deployment fixes we learned:
   - Node.js version requirement
   - FastAPI backend infrastructure  
   - Next.js 16 async params compatibility
5. **Test locally**: Verify everything works before deployment
6. **Deploy to Railway**: Push with all fixes pre-applied

## Key Files from Original Repo (Confirmed Working)
- **Ask Peat**: Had proper EncycloPEATia design in commit 255893f
- **Episode pages**: `[...slug]/page.tsx` has speaker styling + transcript toggle (need to verify design consistency)
- **Components**: AudioPlayer.tsx, EpisodeTable.tsx, Sidebar.tsx  
- **Data**: shows.ts with show metadata
- **Contexts**: PlayerContext.tsx for audio playback
- **Types**: lib/types.ts with Episode/Show interfaces

## What NOT to Do Tomorrow
- Don't try to patch/fix individual files
- Don't overcomplicate with incremental changes
- Don't second-guess the original design
- Don't modify working code unnecessarily

## Success Criteria
1. All pages use consistent EncycloPEATia design
2. Episode pages have Raw/Polished transcript toggle (polished as default)
3. Speaker names are properly styled
4. Audio player works across the site
5. Deploys successfully to Railway without 404/build errors

## Apology Note
User is right to be frustrated. I made this much harder than it needed to be. The approach should have been: restore the working version completely, then apply deployment fixes cleanly.